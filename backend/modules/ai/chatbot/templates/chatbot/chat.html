{% extends "base.html" %}

{% block title %}Project Chatbot | DAEMON-ONE{% endblock %}

{% block content %}
<style>
    /* Hide Base Nav when inside iframe/sidebar mode */
    nav, .nav-container { display: none !important; }
    /* Reset main padding */
    main { padding-top: 0 !important; }
    /* Hide chat widget toggle inside chat */
    #chat-widget { display: none !important; }
</style>

<div class="flex flex-col h-screen bg-[#0f0f12] text-white" x-data="chatbot()">
    <!-- Header -->
    <header class="flex-none px-6 py-4 border-b border-gray-800 bg-[#0a0a0f] flex items-center justify-between">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 rounded-full bg-indigo-600 flex items-center justify-center text-lg">ğŸ¤–</div>
            <div>
                <h1 class="font-bold text-sm">AI Architect</h1>
                <p class="text-xs text-gray-500">System Assistance</p>
            </div>
        </div>
        <!-- Quick Actions (Hidden in sidebar mode if needed, or kept) -->
    </header>

    <!-- Chat Messages Area -->
    <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-4 scroll-smooth">
        
        <!-- Welcome message -->
        <div class="chat-message assistant">
            <div class="message-content">
                <p class="font-medium text-indigo-400 mb-1">AI Assistant</p>
                <div class="text-sm space-y-2 text-gray-300">
                    <p>ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹ Vision Platform ê°œë°œì„ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</p>
                    <p>ì½”ë“œ êµ¬ì¡°, ëª¨ë“ˆ, ê¸°ëŠ¥ êµ¬í˜„ì— ëŒ€í•´ ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”.</p>
                </div>
                
                <div class="mt-4 grid grid-cols-1 gap-2">
                    <button class="text-left text-xs bg-gray-800 hover:bg-gray-700 p-2 rounded transition-colors text-indigo-300"
                            hx-post="/chatbot/send/"
                            hx-vals='{"question": "ì´ í”„ë¡œì íŠ¸ì˜ ëª¨ë“ˆ êµ¬ì¡°ëŠ”?"}'
                            hx-target="#messages-container"
                            hx-swap="beforeend">
                        ğŸ“¦ ëª¨ë“ˆ êµ¬ì¡° ì„¤ëª…í•´ì¤˜
                    </button>
                    <button class="text-left text-xs bg-gray-800 hover:bg-gray-700 p-2 rounded transition-colors text-indigo-300"
                            hx-post="/chatbot/send/"
                            hx-vals='{"question": "ìƒˆë¡œìš´ ë¶„ì„ ëª¨ë“ˆì„ ì¶”ê°€í•˜ë ¤ë©´?"}'
                            hx-target="#messages-container"
                            hx-swap="beforeend">
                        ğŸš€ ìƒˆ ëª¨ë“ˆ ì¶”ê°€ ë°©ë²•
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Dynamic messages -->
        <div id="messages-container" class="space-y-4"></div>
    </div>

    <!-- Input Area -->
    <div class="flex-none p-4 border-t border-gray-800 bg-[#0a0a0f]">
        <form hx-post="/chatbot/send/"
              hx-target="#messages-container"
              hx-swap="beforeend"
              hx-on::after-request="this.reset(); scrollToBottom()"
              class="relative">
            {% csrf_token %}
            <textarea 
                name="question" 
                class="w-full bg-[#18181b] border border-gray-700 rounded-xl px-4 py-3 pl-4 pr-12 text-sm text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 resize-none"
                rows="1"
                placeholder="Ask anything..."
                required
                autocomplete="off"
                @keydown.enter.prevent="if(!$event.shiftKey) { $el.form.requestSubmit() }"></textarea>
            
            <button type="submit" class="absolute right-2 bottom-2 p-1.5 bg-indigo-600 hover:bg-indigo-500 rounded-lg text-white transition-colors">
                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
            </button>
        </form>
        <p class="text-center text-[10px] text-gray-600 mt-2">
            AI can make mistakes. Verify important information.
        </p>
    </div>
</div>

<style>
.chat-message {
    margin-bottom: 1rem;
    padding: 1rem;
    border-radius: 0.75rem;
}

.chat-message.user {
    background: rgba(139, 92, 246, 0.2);
    border: 1px solid rgba(139, 92, 246, 0.4);
    margin-left: 1.5rem;
    color: #fff;
}

.chat-message.assistant {
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.15);
    margin-right: 1.5rem;
    color: #e5e5e5;
}

.message-content {
    font-size: 0.95rem;
    line-height: 1.6;
}

.message-content p {
    margin: 0.5rem 0;
}

.message-content code {
    background: rgba(0, 0, 0, 0.5);
    padding: 0.2rem 0.4rem;
    border-radius: 0.25rem;
    font-size: 0.85em;
    color: #a5b4fc;
    border: 1px solid rgba(255,255,255,0.1);
}

.message-content pre {
    background: #000;
    border: 1px solid rgba(255,255,255,0.15);
    padding: 1rem;
    border-radius: 0.5rem;
    overflow-x: auto;
    margin: 0.75rem 0;
}

.message-sources {
    margin-top: 0.75rem;
    padding-top: 0.75rem;
    border-top: 1px solid rgba(255, 255, 255, 0.08);
    font-size: 0.8rem;
    color: var(--text-muted);
}

.quick-btn {
    padding: 0.5rem 1rem;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 0.5rem;
    color: var(--text-secondary);
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s;
}

.quick-btn:hover {
    background: rgba(139, 92, 246, 0.1);
    border-color: rgba(139, 92, 246, 0.3);
}
</style>

<script>
function scrollToBottom() {
    const container = document.getElementById('chat-messages');
    container.scrollTop = container.scrollHeight;
}

function chatbot() {
    return {
        // Alpine.js state if needed
    };
}
</script>
{% endblock %}
