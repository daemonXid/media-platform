{% extends "base.html" %}

{% block title %}Project Chatbot | DAEMON-ONE{% endblock %}

{% block content %}
<div class="docs-page" x-data="chatbot()">
    <div class="docs-container" style="max-width: 800px;">
        <a href="/" class="back-link">â† Back to Home</a>

        <header style="text-align: center; padding: 2rem 0; margin-bottom: 2rem;">
            <div class="docs-badge">ğŸ¤– AI Assistant</div>
            <h1 class="docs-title gradient-text">Project Chatbot</h1>
            <p class="docs-subtitle">
                Ask questions about this codebase. I'll search the project files and help you understand the code.
            </p>
        </header>

        <!-- Chat Messages -->
        <div 
            id="chat-messages" 
            style="
                min-height: 300px;
                max-height: 500px;
                overflow-y: auto;
                padding: 1rem;
                background: rgba(0, 0, 0, 0.2);
                border-radius: 1rem;
                margin-bottom: 1.5rem;
            "
        >
            <!-- Welcome message -->
            <div class="chat-message assistant">
                <div class="message-content">
                    <p>ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹</p>
                    <p>DAEMON-ONE í”„ë¡œì íŠ¸ì— ëŒ€í•´ ì§ˆë¬¸í•´ì£¼ì„¸ìš”.</p>
                    <p>ì˜ˆì‹œ ì§ˆë¬¸:</p>
                    <ul style="margin: 0.5rem 0; padding-left: 1.5rem; color: var(--text-muted);">
                        <li>"ëª¨ë“ˆì„ ì–´ë–»ê²Œ ì¶”ê°€í•˜ë‚˜ìš”?"</li>
                        <li>"RBACëŠ” ì–´ë–»ê²Œ ì‘ë™í•˜ë‚˜ìš”?"</li>
                        <li>"GenAI í´ë¼ì´ì–¸íŠ¸ ì‚¬ìš©ë²•ì„ ì•Œë ¤ì£¼ì„¸ìš”"</li>
                    </ul>
                </div>
            </div>
            
            <!-- Dynamic messages will be inserted here -->
            <div id="messages-container"></div>
        </div>

        <!-- Input Form -->
        <form 
            hx-post="/chatbot/send/"
            hx-target="#messages-container"
            hx-swap="beforeend"
            hx-on::after-request="this.reset(); scrollToBottom()"
            style="display: flex; gap: 0.75rem;"
        >
            {% csrf_token %}
            <input 
                type="text" 
                name="question" 
                class="form-input" 
                placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..."
                autocomplete="off"
                required
                style="flex: 1;"
            >
            <button type="submit" class="btn-primary" style="white-space: nowrap;">
                ì „ì†¡ â†’
            </button>
        </form>

        <!-- Quick Actions -->
        <div style="margin-top: 1.5rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
            <button 
                class="quick-btn"
                hx-post="/chatbot/send/"
                hx-vals='{"question": "ëª¨ë“ˆ êµ¬ì¡°ë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”"}'
                hx-target="#messages-container"
                hx-swap="beforeend"
            >
                ğŸ“¦ ëª¨ë“ˆ êµ¬ì¡°
            </button>
            <button 
                class="quick-btn"
                hx-post="/chatbot/send/"
                hx-vals='{"question": "HTMX ì‚¬ìš©ë²•ì„ ì•Œë ¤ì£¼ì„¸ìš”"}'
                hx-target="#messages-container"
                hx-swap="beforeend"
            >
                âš¡ HTMX ì‚¬ìš©ë²•
            </button>
            <button 
                class="quick-btn"
                hx-post="/chatbot/send/"
                hx-vals='{"question": "ì¸ì¦ ì‹œìŠ¤í…œì€ ì–´ë–»ê²Œ ì‘ë™í•˜ë‚˜ìš”?"}'
                hx-target="#messages-container"
                hx-swap="beforeend"
            >
                ğŸ” ì¸ì¦ ì‹œìŠ¤í…œ
            </button>
        </div>
    </div>
</div>

<style>
.chat-message {
    margin-bottom: 1rem;
    padding: 1rem;
    border-radius: 0.75rem;
}

.chat-message.user {
    background: rgba(139, 92, 246, 0.15);
    border: 1px solid rgba(139, 92, 246, 0.3);
    margin-left: 2rem;
}

.chat-message.assistant {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.08);
    margin-right: 2rem;
}

.message-content {
    font-size: 0.95rem;
    line-height: 1.6;
}

.message-content p {
    margin: 0.5rem 0;
}

.message-content code {
    background: rgba(0, 0, 0, 0.3);
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
    font-size: 0.85em;
}

.message-content pre {
    background: rgba(0, 0, 0, 0.4);
    padding: 1rem;
    border-radius: 0.5rem;
    overflow-x: auto;
    margin: 0.75rem 0;
}

.message-sources {
    margin-top: 0.75rem;
    padding-top: 0.75rem;
    border-top: 1px solid rgba(255, 255, 255, 0.08);
    font-size: 0.8rem;
    color: var(--text-muted);
}

.quick-btn {
    padding: 0.5rem 1rem;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 0.5rem;
    color: var(--text-secondary);
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s;
}

.quick-btn:hover {
    background: rgba(139, 92, 246, 0.1);
    border-color: rgba(139, 92, 246, 0.3);
}
</style>

<script>
function scrollToBottom() {
    const container = document.getElementById('chat-messages');
    container.scrollTop = container.scrollHeight;
}

function chatbot() {
    return {
        // Alpine.js state if needed
    };
}
</script>
{% endblock %}
